<ng-container *ngIf="dataset$ | async as dataset">
  <div fxLayout="row" class="title-card">
    <div fxFlex="15"></div>
    <div fxFlex="70">
      <mat-card>
        <h1 class="title">
          {{ dataset.title }}
        </h1>
        <h3 class="creators">
          {{ dataset.creator }} ({{ dataset.publicationYear }})
        </h3>
      </mat-card>
    </div>
    <div fxFlex="15"></div>
  </div>

  <div fxLayout="row">
    <div fxFlex="15"></div>
    <div fxFlex="40">
      <mat-card>
        <mat-card-header class="first-header">
          Abstract
        </mat-card-header>
        <mat-card-content>
          <p class="text-content">
            {{ dataset.abstract }}
          </p>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header class="second-header">
          Publication details
        </mat-card-header>
        <mat-card-content>
          <table class="text-content">
            <tr *ngIf="dataset.doi as doi">
              <th>DOI</th>
              <td>
                <a
                  target="_blank"
                  rel="noopener noreferrer"
                  href="{{ doiBaseUrl + doi }}"
                  >{{ doi }}</a
                >
              </td>
            </tr>
            <tr *ngIf="dataset.publisher as publisher">
              <th>Publisher</th>
              <td>{{ publisher }}</td>
            </tr>
            <tr *ngIf="dataset.affiliation as affiliation">
              <th>Affiliation</th>
              <td>{{ affiliation }}</td>
            </tr>
            <tr *ngIf="dataset.resourceType as resourceType">
              <th>Resource Type</th>
              <td>{{ resourceType }}</td>
            </tr>
            <tr *ngIf="dataset.numberOfFiles as numberOfFiles">
              <th>Number of Datasets</th>
              <td>
                {{ numberOfFiles }}
              </td>
            </tr>
            <tr *ngIf="dataset.sizeOfArchive as sizeOfArchive">
              <th>Size</th>
              <td>{{ sizeOfArchive | filesize }}</td>
            </tr>
          </table>
        </mat-card-content>
      </mat-card>

      <ng-container *ngIf="dataset.thumbnail">
        <ng-container *ngTemplateOutlet="datasetsCard"></ng-container>
        <ng-container *ngTemplateOutlet="actionsCard"></ng-container>
      </ng-container>

      <ng-template #datasetsCard>
        <mat-card>
          <mat-card-header class="third-header">
            Datasets
          </mat-card-header>
          <mat-card-content>
            <mat-list role="list">
              <mat-list-item
                role="listitem"
                *ngFor="let pid of dataset.pidArray"
              >
                {{ pid }}
              </mat-list-item>
            </mat-list>
          </mat-card-content>
        </mat-card>
      </ng-template>

      <ng-template #actionsCard>
        <mat-card>
          <mat-card-header class="fourth-header">
            Actions
          </mat-card-header>
          <mat-card-content>
            <p class="text-content">
              Instructions: Login with brightness username and password
            </p>

            <ng-container *ngIf="dataset.url as url">
              <a
                mat-raised-button
                target="_blank"
                rel="noopener noreferrer"
                href="{{ url }}"
                class="access-button"
              >
                Access Data
              </a>
            </ng-container>

            <ng-container *ngIf="dataset.dataDescription as url">
              <a
                mat-raised-button
                target="_blank"
                rel="noopener noreferrer"
                href="{{ url }}"
                class="description-button"
              >
                Data Description
              </a>
            </ng-container>
          </mat-card-content>
        </mat-card>
      </ng-template>

      <ng-container *ngIf="!productionMode">
        <mat-card *ngIf="datasetJson$ | async as json">
          <button mat-stroked-button (click)="show = !show">
            {{ show ? "Hide MetaData" : "Show Metadata" }}
          </button>
          <div class="json-container" *ngIf="show">
            <div [innerHTML]="json"></div>
          </div>
        </mat-card>
      </ng-container>
    </div>
    <div fxFlex="30">
      <ng-container *ngIf="dataset.thumbnail as thumbnail; else noThumbnail">
        <mat-card>
          <img mat-card-image src="{{ thumbnail }}" alt="data thumbnail" />
        </mat-card>
      </ng-container>

      <ng-template #noThumbnail>
        <ng-container *ngTemplateOutlet="datasetsCard"></ng-container>
        <ng-container *ngTemplateOutlet="actionsCard"></ng-container>
      </ng-template>
    </div>
    <div fxFlex="15"></div>
  </div>
</ng-container>
